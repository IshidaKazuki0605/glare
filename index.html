<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0 maximum-scale=1.0"
    />

    <meta
      name="description"
      content="ã‚°ãƒ¬ã‚¢ãƒ†ãƒ‹ã‚¹ã‚µãƒ¼ã‚¯ãƒ«ã®å‚åŠ è²»ã‚’è¨ˆç®—ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚"
    />
    <title>ã‚°ãƒ¬ã‚¢ãƒ†ãƒ‹ã‚¹ã‚µãƒ¼ã‚¯ãƒ«å‚åŠ è²»è¨ˆç®—ãƒ„ãƒ¼ãƒ«</title>
    <script
      src="https://code.jquery.com/jquery-3.7.1.slim.min.js"
      integrity="sha256-kmHvs0B+OpCW5GVHUNjv9rOmY0IvSIRcf7zGUDTDQM8="
      crossorigin="anonymous"
    ></script>
    <style>
      th {
        text-align: left;
      }
    </style>
    <script>
      const GUEST_UNIT_FEE = 1300;

      let addedCourtRentList = [];

      $(document).ready(function () {
        updateDisp();

        // ã€Œå€Ÿã‚Šã‚‹ã‚³ãƒ¼ãƒˆã‚’è¿½åŠ ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚ã®æŒ™å‹•
        $("#input-court-rent-add-btn").on("click", function () {
          // å…¥åŠ›ã•ã‚ŒãŸå€Ÿã‚Šã‚‹ã‚³ãƒ¼ãƒˆæƒ…å ±ã‚’ã€è¿½åŠ æ¸ˆã¿å€Ÿã‚Šã‚‹ã‚³ãƒ¼ãƒˆæƒ…å ±ä¸€è¦§ã¸è¿½åŠ 
          addedCourtRentList.push({
            name: $("#input-court-rent-fee-unit option:selected").text(),
            number: Number($("#input-court-rent-number").val()),
            time: Number($("#input-court-rent-time").val()),
            fee: Number(
              $("#input-court-rent-fee-unit").val() *
                $("#input-court-rent-number").val() *
                $("#input-court-rent-time").val()
            ),
          });

          // è¿½åŠ æ¸ˆã¿å€Ÿã‚Šã‚‹ã‚³ãƒ¼ãƒˆæƒ…å ±ä¸€è¦§ã‚’æç”»
          $("#disp-added-court-rent-list").empty();
          addedCourtRentList.forEach((addedCourtRent, i) => {
            $("#disp-added-court-rent-list").append(
              "<div><small>" +
                `${i + 1}` +
                `${addedCourtRent.name}ï¼` +
                `${addedCourtRent.number}ã‚³ãƒ¼ãƒˆï¼` +
                `${addedCourtRent.time}æ™‚é–“ï¼` +
                `${addedCourtRent.fee.toLocaleString()}å††` +
                "</small></div>"
            );
          });

          // è¿½åŠ æ¸ˆã¿å€Ÿã‚Šã‚‹ã‚³ãƒ¼ãƒˆã®åˆè¨ˆã‚³ãƒ¼ãƒˆåˆ©ç”¨æ–™ã®è¡¨ç¤º
          $("#disp-added-court-rent-fee-total").text(
            calcAddedCourtRentFeeTotal().toLocaleString()
          );

          updateDisp();
        });

        // è¿½åŠ æ¸ˆã¿å€Ÿã‚Šã‚‹ã‚³ãƒ¼ãƒˆä¸€è¦§ã®ã€Œã‚¯ãƒªã‚¢ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚ã®æŒ™å‹•
        $("#added-court-rent-clear-btn").on("click", function () {
          if (addedCourtRentList.length === 0) {
            alert("è¿½åŠ æ¸ˆã¿å€Ÿã‚Šã‚‹ã‚³ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
          } else {
            let confirmMsg = "ä¸‹è¨˜ã®è¿½åŠ æ¸ˆã¿ã®å€Ÿã‚Šã‚‹ã‚³ãƒ¼ãƒˆã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã€‚\n\n";
            addedCourtRentList.forEach((addedCourtRent, i) => {
              confirmMsg +=
                `${i + 1}` +
                `${addedCourtRent.name}ï¼` +
                `${addedCourtRent.number}ã‚³ãƒ¼ãƒˆï¼` +
                `${addedCourtRent.time}æ™‚é–“ï¼` +
                `${addedCourtRent.fee.toLocaleString()}å††\n`;
            });
            if (window.confirm(confirmMsg)) {
              addedCourtRentList = [];
              $("#disp-added-court-rent-list").empty();
              $("#disp-added-court-rent-list").append(
                "å€Ÿã‚Šã‚‹ã‚³ãƒ¼ãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚"
              );
              $("#disp-added-court-rent-fee-total").text(0);
              $("#disp-result").val("å€Ÿã‚Šã‚‹ã‚³ãƒ¼ãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚");
            }
            updateDisp();
          }
        });

        $(".upd-disp").change(function () {
          updateDisp();
        });

        function dispResultCourt() {
          return `ã‚³ãƒ¼ãƒˆã€€ï¼š${calcAddedCourtRentFeeTotal().toLocaleString()}å††`;
        }

        function dispResultNaiho() {
          return `å†…éƒ¨ä¿ç•™ï¼š${getInputNaiho().toLocaleString()}å††`;
        }

        function dispResultGuestFee() {
          return `ã‚²ã‚¹ãƒˆã€€ï¼š${GUEST_UNIT_FEE.toLocaleString()}å††Ã—${getInputGuestNumber()}äººï¼${calcGuestFeeTotal().toLocaleString()}å††`;
        }

        function dispResultMemberFee() {
          return `ãƒ¡ãƒ³ãƒãƒ¼ï¼š${calcMemberFeeUnit().toLocaleString()}å††Ã—${getInputMemberNumber()}äººï¼${calcMemberFeeTotal().toLocaleString()}å††`;
        }

        function dispResultOverage() {
          return `ä½™ã‚Šã€€ã€€ï¼š${calcOverage().toLocaleString()}å††`;
        }

        function updateDisp() {
          // å‚åŠ è²»è¨ˆç®—çµæœã‚’æç”»ã™ã‚‹
          if (addedCourtRentList.length === 0) {
            $("#disp-result").val("å€Ÿã‚Šã‚‹ã‚³ãƒ¼ãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚");
          } else {
            $("#disp-result").val(
              [
                dispResultCourt(),
                dispResultNaiho(),
                dispResultGuestFee(),
                dispResultMemberFee(),
                dispResultOverage(),
              ].join("\n")
            );
          }
        }

        // è¿½åŠ æ¸ˆã¿å€Ÿã‚Šã‚‹ã‚³ãƒ¼ãƒˆã®åˆè¨ˆåˆ©ç”¨æ–™
        function calcAddedCourtRentFeeTotal() {
          return addedCourtRentList.reduce(
            (sum, addedCourtRent) => sum + (addedCourtRent.fee || 0),
            0
          );
        }

        // å…¥åŠ›ã—ãŸå†…éƒ¨ä¿ç•™ã®é‡‘é¡
        function getInputNaiho() {
          return Number($("#input-naiho").val());
        }

        // å…¥åŠ›ã—ãŸãƒ¡ãƒ³ãƒãƒ¼ã®å‚åŠ äººæ•°ã‚’å–å¾—
        function getInputMemberNumber() {
          return Number($("#input-member-number").val());
        }

        // å…¥åŠ›ã—ãŸã‚²ã‚¹ãƒˆã®å‚åŠ äººæ•°ã‚’å–å¾—
        function getInputGuestNumber() {
          return Number($("#input-guest-number").val());
        }

        // ã‚²ã‚¹ãƒˆã®åˆè¨ˆå‚åŠ è²»
        function calcGuestFeeTotal() {
          return getInputGuestNumber() * GUEST_UNIT_FEE;
        }

        // ä¸è¶³é‡‘ã®è¨ˆç®—
        // (ä¸è¶³é‡‘) = (ã‚³ãƒ¼ãƒˆåˆ©ç”¨æ–™) - (ã‚²ã‚¹ãƒˆã®åˆè¨ˆå‚åŠ è²») - (å†…éƒ¨ä¿ç•™åˆ†)
        function calcShortageFee() {
          return (
            calcAddedCourtRentFeeTotal() - calcGuestFeeTotal() - getInputNaiho()
          );
        }

        // ãƒ¡ãƒ³ãƒä¸€äººå½“ãŸã‚Šã®å‚åŠ è²»ã‚’è¨ˆç®—
        function calcMemberFeeUnit() {
          return Math.ceil(calcShortageFee() / getInputMemberNumber() / 1) * 1;
        }

        // çµæœçš„ã«ãƒ¡ãƒ³ãƒå…¨å“¡ãŒè² æ‹…ã™ã‚‹ã“ã¨ã«ãªã‚‹å‚åŠ è²»ã‚’è¨ˆç®—
        function calcMemberFeeTotal() {
          return calcMemberFeeUnit() * getInputMemberNumber();
        }

        // æœ€çµ‚çš„ã«ä½™ã‚‹é‡‘é¡ã‚’è¨ˆç®—
        function calcOverage() {
          return calcMemberFeeTotal() - calcShortageFee();
        }

        // å‚åŠ è²»è¨ˆç®—çµæœã‚’ã‚³ãƒ”ãƒ¼
        $("#copy-clipboard-result").click(function () {
          if (addedCourtRentList.length === 0) {
            alert("å€Ÿã‚Šã‚‹ã‚³ãƒ¼ãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚");
          } else {
            const clipboard = $('<textarea readonly="readonly"></textarea>');
            clipboard.val($("#disp-result").val());
            $(this).append(clipboard);
            clipboard.select();
            document.execCommand("copy");
            clipboard.remove();
            alert(
              `ä¸‹è¨˜ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚\n\n` +
                `---------------------------\n` +
                `${$("#disp-result").val()}\n` +
                `---------------------------`
            );
          }
        });
      });
    </script>
  </head>

  <body>
    <section>
      <div>
        <fieldset>
          <legend>å€Ÿã‚Šã‚‹ã‚³ãƒ¼ãƒˆã‚’è¿½åŠ </legend>

          <div>
            <select id="input-court-rent-fee-unit">
              <option value="2200" label="ã€ğŸ•—2-4ãƒ†ãƒ‹ã‚¹ã€‘ğŸ–ï¸ã‚ªãƒ ãƒ‹">
                ã€2-4ãƒ†ãƒ‹ã‚¹ã€‘ï¸ã‚ªãƒ ãƒ‹
              </option>
              <option value="2200" label="ã€ğŸ•—2-4ãƒ†ãƒ‹ã‚¹ã€‘ğŸ˜ãƒãƒ¼ãƒ‰">
                ã€2-4ãƒ†ãƒ‹ã‚¹ã€‘ãƒãƒ¼ãƒ‰
              </option>
              <option value="2300" label="ã€ğŸŒã‚µãƒ³ãƒ†ãƒ‹ã‚¹ã€‘ğŸ–ï¸ã‚ªãƒ ãƒ‹">
                ã€ã‚µãƒ³ãƒ†ãƒ‹ã‚¹ã€‘ã‚ªãƒ ãƒ‹
              </option>
              <option value="2000" label="ã€ğŸŒã‚µãƒ³ãƒ†ãƒ‹ã‚¹ã€‘ğŸ˜ãƒãƒ¼ãƒ‰">
                ã€ã‚µãƒ³ãƒ†ãƒ‹ã‚¹ã€‘ãƒãƒ¼ãƒ‰
              </option>
              <option value="2200" label="ã€ğŸ…¿ï¸æ¾ãƒ†ãƒ‹ã€‘å‰²å¼•ãªã—ğŸ™…">
                ã€æ¾ãƒ†ãƒ‹ã€‘å‰²å¼•ãªã—
              </option>
              <option value="2000" label="ã€ğŸ…¿ï¸æ¾ãƒ†ãƒ‹ã€‘å‰²å¼•ã‚ã‚ŠğŸ™†">
                ã€æ¾ãƒ†ãƒ‹ã€‘å‰²å¼•ã‚ã‚Š
              </option>
            </select>
            <select id="input-court-rent-number">
              <option value="1" selected>1ã‚³ãƒ¼ãƒˆ</option>
              <option value="2">2ã‚³ãƒ¼ãƒˆ</option>
              <option value="3">3ã‚³ãƒ¼ãƒˆ</option>
            </select>
            <select id="input-court-rent-time">
              <option value="1">1æ™‚é–“</option>
              <option value="2" selected>2æ™‚é–“</option>
              <option value="3">3æ™‚é–“</option>
            </select>
          </div>
          <hr />
          <button type="button" id="input-court-rent-add-btn" class="upd-disp">
            å€Ÿã‚Šã‚‹ã‚³ãƒ¼ãƒˆã‚’è¿½åŠ 
          </button>
        </fieldset>

        <fieldset>
          <legend>è¿½åŠ æ¸ˆã¿å€Ÿã‚Šã‚‹ã‚³ãƒ¼ãƒˆä¸€è¦§</legend>
          <div id="disp-added-court-rent-list" class="upd-disp">
            å€Ÿã‚Šã‚‹ã‚³ãƒ¼ãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
          </div>

          <hr />

          <div>
            <span
              >åˆè¨ˆã‚³ãƒ¼ãƒˆä»£:
              <span id="disp-added-court-rent-fee-total">0</span>å††</span
            >
            <!-- ãƒ‡ã‚¶ã‚¤ãƒ³ã®ãŸã‚ã ã‘ã«æŒ¿å…¥ã•ã‚ŒãŸæ‚²ã—ãç©ºç™½ -->
            <span>&nbsp;&nbsp;</span>
            <button type="button" id="added-court-rent-clear-btn">
              ã‚¯ãƒªã‚¢
            </button>
          </div>
        </fieldset>
      </div>
      <div>
        <label for="input-naiho">å†…éƒ¨ä¿ç•™ã®ä½¿ç”¨</label>
        <select id="input-naiho" class="upd-disp">
          <option value="0" selected>ä½¿ã‚ãªã„</option>
          <option value="100">100å††</option>
          <option value="200">200å††</option>
          <option value="300">300å††</option>
          <option value="400">400å††</option>
          <option value="500">500å††</option>
          <option value="600">600å††</option>
          <option value="700">700å††</option>
          <option value="800">800å††</option>
          <option value="900">900å††</option>
          <option value="1000">1000å††</option>
          <option value="1100">1100å††</option>
          <option value="1200">1200å††</option>
          <option value="1300">1300å††</option>
          <option value="1400">1400å††</option>
          <option value="1500">1500å††</option>
          <option value="1600">1600å††</option>
          <option value="1700">1700å††</option>
          <option value="1800">1800å††</option>
          <option value="1900">1900å††</option>
          <option value="2000">2000å††</option>
        </select>
      </div>
      <div>
        <label for="input-member-number">ãƒ¡ãƒ³ãƒãƒ¼ã®äººæ•°</label>
        <select id="input-member-number" class="upd-disp">
          <option value="1">1äºº</option>
          <option value="2">2äºº</option>
          <option value="3">3äºº</option>
          <option value="4" selected>4äºº</option>
          <option value="5">5äºº</option>
          <option value="6">6äºº</option>
          <option value="7">7äºº</option>
          <option value="8">8äºº</option>
          <option value="9">9äºº</option>
        </select>
      </div>
      <div>
        <label for="input-guest-number">ã‚²ã‚¹ãƒˆã®äººæ•°</label>
        <select id="input-guest-number" class="upd-disp">
          <option value="0" selected>ã„ãªã„</option>
          <option value="1">1äºº</option>
          <option value="2">2äºº</option>
          <option value="3">3äºº</option>
          <option value="4">4äºº</option>
          <option value="5">5äºº</option>
          <option value="6">6äºº</option>
          <option value="7">7äºº</option>
          <option value="8">8äºº</option>
          <option value="9">9äºº</option>
        </select>
      </div>
    </section>

    <hr />

    <section>
      <button id="copy-clipboard-result">è¨ˆç®—çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
      <div><textarea id="disp-result" rows="7" cols="40"></textarea></div>
    </section>

    <footer style="position: fixed; bottom: 0">
      <span>Ver. 3.1.2</span>
    </footer>
  </body>
</html>
